# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

# Web-ларёк — интернет-магазин для веб-разработчиков

Web-ларёк — это SPA-приложение, в котором можно:
- просматривать каталог товаров;
- открывать детальную карточку товара;
- добавлять товары в корзину;
- оформлять заказ в два шага: адрес и контактные данные;
- получать подтверждение оформления заказа.

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных

IProduct — товар каталога

```
id: string — идентификатор;
name: string — название;
cost: number — цена;
desc?: string — описание (опционально);
img_url: string — изображение;
category: string — категория.
```

IOrder — данные покупателя

```
payment: 'card' | 'cash' — способ оплаты;
address: string — адрес доставки;
name: string — имя покупателя;
email: string — e-mail;
phone: string — телефон.
```

OrderPayload — данные заказа для API:

```
payment: 'card' | 'cash';
address: string;
name: string;
email: string;
phone: string;
items: string[] — список ID товаров;
total: number — сумма заказа.
```
## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:
- Представления(View) - слой представления, отвечает за отображение данных на странице;
- Модели(Model) - слой данных, отвечает за хранение и изменение данных;
- Презентор(Presenter) - слой, отвечающий за связь представления и данных.


### Базовые классы

#### Класс Api
Содержит в себе базовую логику отправки запроса. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:
- `get` - выполняет GET запрос на переданный в параметрах эндпоинт и возвращает промис с объектом, которым ответил сервер.
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на эндпоинт, переданный, как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.
Пример: загрузка товаров, оформление заказа.

#### Класс EventEmitter
Брокер событий позволяет отправить события и подписаться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом `IEventEmitter`:
- `on` - подписка на событие;
- `emit` - инициализация события;
- `off(event, callback)` — отписка от события.
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

### Модели данных

#### Класс ProductModel
Отвечает за хранение списка товаров и выбор товара для предпросмотра.
Поля:
- products: IProduct[] — массив загруженных товаров.
- preview: IProduct | null — товар, выбранный для предпросмотра (хранит весь объект товара).\
  
Методы:
- setProducts(products: IProduct[]): void - сохраняет массив товаров (например, после загрузки из API)
- getProduct(id: string): IProduct | undefined - возвращает товар по ID
- setPreview(product: IProduct | null): void - устанавливает товар для предпросмотра
  
#### Класс CartModel
Отвечает за управление состоянием корзины, расчет итоговой суммы.
Поля:
- items: IProduct[] — массив товаров в корзине

Методы:
- addItem(product: IProduct): void - добавляет товар в корзину
- removeItem(productId: string): void - удаляет товар из корзины
- clearCart(): void - полностью очищает корзину
- getTotal() — возвращает общую стоимость

#### Класс OrderModel
Хранит данные для оформления заказа и проверяет их корректность.
Поля:
- payment: PaymentMethod — способ оплаты ('card' | 'cash')
- address: string - адрес доставки
- name: string - имя покупателя (отображается в заказе)
- email: string - электронная почта покупателя
- phone: string - номер телефона для связи.


Методы:
- setPayment(method: PaymentMethod): void — сохранить выбранный способ оплаты
- setAddress(address: string): void — сохранить адрес доставки
- setName(name: string): void — сохранить имя покупателя
- setEmail(email: string): void — сохранить электронную почту
- setPhone(phone: string): void — сохранить телефон
- validate(): boolean — проверяет заполненность и корректность всех полей (адрес, имя, email, телефон, метод оплаты).

### API слой

#### Интерфейс ICommerceAPI
Расширяет IApiClient

Методы:
- getProducts(): Promise<IProduct[]> — получает список всех товаров
- getProductById(id: string): Promise<IProduct> — получает один товар по ID
- createOrder(order: OrderPayload) — оформить заказ.

OrderPayload включает:
- payment: 'card' | 'cash'
- address: string
- email: string
- phone: string
- items: string[] — ID товаров
- total: number — сумма заказа

### Представления (Views)
Классы отображают данные внутри переданных контейнеров. Все они наследуются от Component или специализированных базовых классов.

#### Класс Component
Базовый абстрактный класс для всех View.

Методы:
- toggleClass(element, className, force?) — переключение класса DOM-элемента
- setText(element, value) — установка текстового содержимого
- setDisabled(element, state) — включение/отключение кнопки
- setHidden(element) — скрытие элемента (display: none)
- setVisible(element) — показать элемент (снять display: none)
- setImage(img, src, alt?) — установка src и alt для <img>
- render(container) — отрисовка компонента.

#### Класс Modal
Реализует модальное окно. Управляет открытием/закрытием, устанавливает слушатели на клик по фону и кнопке-крестику.

Поля:
- _closeButton: HTMLButtonElement — кнопка закрытия
- _content: HTMLElement — контейнер для содержимого
- events: IEventEmitter — брокер событий

Методы:
- open() — открыть модалку
- close() — закрыть модалку
- set content(value: HTMLElement) — заменить содержимое

#### Класс ProductView
Базовый класс для отображения товара.

Поля:
- id: string — идентификатор товара.
- title: HTMLElement — название
- category: HTMLElement — категория
- price: HTMLElement — цена
- image: HTMLImageElement — изображение.

Наследники:
- ProductCard — карточка товара в каталоге
- ProductCardPreview — предпросмотр товара (дополнительно содержит кнопку «Купить / Убрать из корзины»)
- BasketItem — строка корзины (отображает порядковый номер, название, цену и кнопку удаления).

#### Класс Basket
Отображает корзину целиком в модальном окне.

Поля:
- _list: HTMLElement — список товаров
- _totalPrice: HTMLElement — общая сумма
- orderButton: HTMLButtonElement — кнопка «Оформить заказ».

#### Класс Page
Главная страница приложения.

Поля:
- elementCounter: HTMLElement — счётчик товаров в корзине
- buttonBasket: HTMLButtonElement — кнопка открытия корзины
- galleryCard: HTMLElement — контейнер для карточек каталога.

Методы:
- setLocked(value: boolean) — блокировка страницы при открытом модальном окне.

##### Класс Form
Базовый класс для всех форм.

Поля:
- _submit: HTMLButtonElement — кнопка отправки
- _errors: HTMLElement — контейнер для сообщений об ошибках.

Методы:
- onInputChange(field: keyof T, value: string) — защищённый метод, эмитит событие изменения поля.

#### Класс FormOrder
Форма первого шага заказа (оплата и адрес).

Методы:
- reset() — сброс введённых данных
- Выбранный метод оплаты хранится в модели (OrderModel), а форма только отображает состояние.

#### Класс FormContacts
Форма второго шага заказа (контактные данные).

Методы:
- reset() — сброс введённых данных.

#### Класс FormSuccess
Компонент уведомления об успешном заказе.

Поля:
- total: number — сумма заказа
- closeButton: HTMLButtonElement — кнопка закрытия.

### Презентер
В проекте используется один презентер, код которого находится в index.ts.
Задачи:
1. Подписывается на события от View
2. Обновляет модели
3. Управляет отображением модальных окон
4. Загружает данные через API
5. Обновляет View при изменениях в моделях

Основной поток:
- Загрузка товаров → ProductModel → обновление каталога.
- Добавление в корзину → CartModel → обновление корзины.
- Оформление заказа → проверка в OrderModel.validate() → отправка через ICommerceAPI.